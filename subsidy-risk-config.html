<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>补贴风险指标配置</title>
  <style>
    :root {
      --primary-blue: #1677ff;
      --primary-blue-hover: #4096ff;
      --primary-blue-active: #0958d9;
      --primary-blue-light: #e6f4ff;
      --success-green: #52c41a;
      --warning-orange: #fa8c16;
      --error-red: #ff4d4f;
      --bg-layout: #f5f5f5;
      --bg-container: #ffffff;
      --border-color: #d9d9d9;
      --border-color-light: #f0f0f0;
      --text-primary: #000000d9;
      --text-secondary: #00000073;
      --text-disabled: #00000040;
      --shadow-card: 0 1px 2px 0 rgba(0, 0, 0, 0.03), 0 1px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px 0 rgba(0, 0, 0, 0.02);
    }
    * { font-family: 'PingFang SC', 'Microsoft YaHei', system-ui, -apple-system, sans-serif; }
    body { background: var(--bg-container); color: var(--text-primary); font-size: 14px; line-height: 1.5715; margin: 0; padding: 24px; padding-bottom: 80px; }
    .config-header { margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color-light); }
    .config-description { color: var(--text-secondary); margin: 0; }

    .tag-list { display: flex; flex-direction: column; gap: 8px; }
    
    .fixed-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border: 1px solid var(--border-color-light);
      border-radius: 8px;
      background: var(--bg-container);
      transition: all 0.2s ease;
    }

    .fixed-item:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 2px 8px rgba(22, 119, 255, 0.1);
    }

    .fixed-item-left {
      min-width: 120px;
      margin-right: 16px;
    }

    .fixed-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 16px;
      border: 1px solid #91caff;
      background: var(--primary-blue-light);
      color: var(--primary-blue);
      font-size: 12px;
      cursor: pointer;
      user-select: none;
      position: relative;
      transition: all 0.2s ease;
      min-height: 28px;
    }

    .fixed-tag:hover {
      background: #bae0ff;
      border-color: var(--primary-blue-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(22, 119, 255, 0.2);
    }

    .fixed-item.selected .fixed-tag {
      background: var(--primary-blue);
      color: #fff;
      border-color: var(--primary-blue);
      box-shadow: 0 2px 8px rgba(22, 119, 255, 0.3);
      padding-right: 32px;
    }

    .fixed-item.selected .fixed-tag:hover {
      background: var(--primary-blue-hover);
      border-color: var(--primary-blue-hover);
    }

    .fixed-tag .check-icon {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      opacity: 0;
      transition: opacity 0.2s ease;
      color: var(--primary-blue);
    }

    .fixed-item.selected .fixed-tag .check-icon {
      opacity: 1;
      color: #fff;
    }

    .fixed-item-right {
      flex: 1;
      padding-left: 16px;
      border-left: 1px solid var(--border-color-light);
    }

    .calc-info {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 8px;
    }

    .risk-levels {
      display: flex;
      gap: 16px;
      font-size: 12px;
    }

    .risk-high {
      color: var(--error-red);
    }

    .risk-medium {
      color: var(--warning-orange);
    }

    .risk-low {
      color: var(--success-green);
    }
    .module-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-blue);
            display: inline-block;
        }

    .page-footer { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-container); border-top: 1px solid var(--border-color-light); padding: 12px 16px; display: flex; align-items: center; gap: 12px; box-shadow: 0 -2px 8px rgba(0,0,0,0.1); z-index: 100; }
    .btn { display: inline-flex; align-items: center; justify-content: center; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; text-decoration: none; border: 1px solid transparent; cursor: pointer; transition: all 0.2s ease; gap: 8px; }
    .btn-primary { background: var(--primary-blue); color: #fff; border-color: var(--primary-blue); }
    .btn-primary:hover { background: var(--primary-blue-hover); border-color: var(--primary-blue-hover); }
    .btn-default { background: var(--bg-container); color: var(--text-primary); border-color: var(--border-color); }
    .btn-default:hover { color: var(--primary-blue); border-color: var(--primary-blue); }
    .footer-count { flex: 1; color: var(--primary-blue); text-align: right; }
  </style>
</head>
<body>
  <div class="config-header">
    <p class="config-description">机构可根据实际情况，灵活启用、停用补贴风险指标</p>
  </div>
  <h3 class="module-title">默认指标</h3>
  <!-- 指标标签列表（仅不可配置） -->
  <div id="tagContainer" class="tag-list" aria-live="polite"></div>

  <!-- 固定底部操作栏 -->
  <div class="page-footer">
    <div class="footer-count"><span id="enabledCount">启用指标数量 0/0</span></div>
    <button class="btn btn-default" onclick="goBack()">返回</button>
    <button class="btn btn-primary" onclick="saveAllConfig()">保存</button>
  </div>

  <script>
    /**
     * 指标对象
     * @typedef {Object} Indicator
     * @property {number} id 指标ID
     * @property {string} name 指标名称
     * @property {boolean} enabled 是否启用（选择）
     */

    /** 模拟数据（补贴风险，全部不可配置） */
    const indicators = [
      { id: 101, name: '本月网点耗能预警', enabled: true, calc: '网点下当月累计消耗成本/预估当月收益，高风险含预估当月0收益商户', high: {op: '>=', value: 150}, medium: {op: '>=', value: 90}, low: {op: '<', value: 90} },
      { id: 102, name: '上月网点耗能预警', enabled: false, calc: '网点下上月累计消耗成本/上月实际收益，高风险含预估当月0收益商户', high: {op: '>=', value: 150}, medium: {op: '>=', value: 90}, low: {op: '<', value: 90} },
      { id: 103, name: '补贴激增预警', enabled: true, calc: '与上月同期消耗成本对比', high: {op: '>=', value: 150}, medium: {op: '>=', value: 90}, low: {op: '<', value: 90} },
      { id: 104, name: '本月全省耗能预警', enabled: false, calc: '全省网点下当月累计消耗成本/预估当月收益，高风险含预估当月0收益商户', high: {op: '>=', value: 150}, medium: {op: '>=', value: 90}, low: {op: '<', value: 90} }
    ];

    document.addEventListener('DOMContentLoaded', () => {
      renderTagList();
      updateCount();
    });

    /**
     * 渲染固定指标列表
     * @returns {void}
     */
    function renderTagList() {
      const container = document.getElementById('tagContainer');
      container.innerHTML = '';
      indicators.forEach(ind => {
        const fixedItem = document.createElement('div');
        fixedItem.className = 'fixed-item' + (ind.enabled ? ' selected' : '');
        
        // 左侧标签区域
        const leftDiv = document.createElement('div');
        leftDiv.className = 'fixed-item-left';
        
        const tag = document.createElement('div');
        tag.className = 'fixed-tag';
        tag.setAttribute('role', 'button');
        tag.setAttribute('aria-pressed', String(!!ind.enabled));
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = ind.name;
        tag.appendChild(nameSpan);
        
        const checkIcon = document.createElement('div');
        checkIcon.className = 'check-icon';
        checkIcon.innerHTML = `
          <svg viewBox="0 0 16 16" fill="currentColor" style="width: 100%; height: 100%;">
            <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
          </svg>
        `;
        tag.appendChild(checkIcon);
        
        tag.addEventListener('click', () => onToggleSelect(ind.id));
        leftDiv.appendChild(tag);
        
        // 右侧信息区域
        const rightDiv = document.createElement('div');
        rightDiv.className = 'fixed-item-right';
        
        const calcInfo = document.createElement('div');
        calcInfo.className = 'calc-info';
        calcInfo.textContent = `指标计算方式：${ind.calc}`;
        rightDiv.appendChild(calcInfo);
        
        const riskLevels = document.createElement('div');
        riskLevels.className = 'risk-levels';
        riskLevels.innerHTML = `
          <span class="risk-high">高风险：指标值${ind.high.op} ${ind.high.value}%</span>
          <span class="risk-medium">中风险：指标值${ind.medium.op} ${ind.medium.value}%</span>
          <span class="risk-low">低风险：指标值${ind.low.op} ${ind.low.value}%</span>
        `;
        rightDiv.appendChild(riskLevels);
        
        fixedItem.appendChild(leftDiv);
        fixedItem.appendChild(rightDiv);
        container.appendChild(fixedItem);
      });
    }

    /**
     * 切换选中（启用/禁用）
     * @param {number} id 指标ID
     * @returns {void}
     */
    function onToggleSelect(id) {
      const ind = indicators.find(x => x.id === id);
      if (!ind) return;
      ind.enabled = !ind.enabled;
      renderTagList();
      updateCount();
    }

    /**
     * 更新底部"已启用数量"
     * @returns {void}
     */
    function updateCount() {
      const enabledCount = indicators.filter(x => x.enabled).length;
      const totalCount = indicators.length;
      document.getElementById('enabledCount').textContent = `启用指标数量 ${enabledCount}/${totalCount}`;
    }

    /**
     * 返回上一页/关闭弹窗（由父页面接管或直接关闭窗口）
     * @returns {void}
     */
    function goBack() { closePage(); }

    /**
     * 关闭当前页面（供父页面弹窗集成调用）
     * @returns {void}
     */
    function closePage() {
      if (window.parent && window.parent.closeIndicatorConfigModal) {
        window.parent.closeIndicatorConfigModal();
      } else {
        window.close();
      }
    }

    /**
     * 保存全部配置（示例内仅提示+关闭）
     * @returns {void}
     */
    function saveAllConfig() {
      console.log('保存配置：', indicators);
      alert('配置保存成功！');
      closePage();
    }
  </script>
</body>
</html>
